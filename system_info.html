<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Info</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">System Info</a>
</nav>
<div class="container mt-4">
    <h1 class="mb-4">System Info for {{ controller_ip }}</h1>
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Live System Info</h5>
            <ul id="systemInfoList" class="list-group">
                <li class="list-group-item">System Name: <span id="system-name"></span></li>
                <li class="list-group-item">System IP: <span id="system-ip"></span></li>
                <li class="list-group-item">System Uptime: <span id="system-uptime"></span></li>
                <li class="list-group-item">CPU Temperature: <span id="cpu-temp"></span></li>
                <li class="list-group-item">CPU Usage: <span id="cpu-usage"></span></li>
                <li class="list-group-item">Memory Usage: <span id="memory-usage"></span></li>
                <li class="list-group-item">Disk Usage: <span id="disk-usage"></span></li>
                <li class="list-group-item">Network Upload: <span id="network-upload"></span></li>
                <li class="list-group-item">Network Download: <span id="network-download"></span></li>
                <li class="list-group-item">Active Processes: <span id="active-processes"></span></li>
            </ul>
        </div>
    </div>
    <h2>System Info Graphs</h2>
    <canvas id="systemInfoChart" width="400" height="200"></canvas>
    <a href="{{ url_for('index') }}" class="btn btn-secondary">Zurück zu den Controllern</a>
</div>
<script>
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    var chart;
    var systemInfoChartData = {
        labels: ['CPU Usage', 'Memory Usage', 'Disk Usage', 'Network Upload', 'Network Download'],
        datasets: [{
            label: 'Value (%)',
            data: [],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    };

    function fetchSystemInfo() {
        fetch('/api/system_info')
            .then(response => response.json())
            .then(data => {
                document.getElementById('system-name').textContent = data.system_name;
                document.getElementById('system-ip').textContent = data.system_ip;
                document.getElementById('system-uptime').textContent = data.system_uptime;
                document.getElementById('cpu-temp').textContent = data.cpu_temp !== null ? data.cpu_temp + ' °C' : 'N/A';
                document.getElementById('cpu-usage').textContent = data.cpu_usage + ' %';
                document.getElementById('memory-usage').textContent = data.memory_usage + ' %';
                document.getElementById('disk-usage').textContent = data.disk_usage + ' %';
                document.getElementById('network-upload').textContent = data.network_upload.toFixed(2) + ' KB/s';
                document.getElementById('network-download').textContent = data.network_download.toFixed(2) + ' KB/s';
                document.getElementById('active-processes').textContent = data.active_processes;

                updateSystemInfoChart(data);
            });
    }

    function updateSystemInfoChart(data) {
        chart.data.datasets[0].data = [
            data.cpu_usage,
            data.memory_usage,
            data.disk_usage,
            (data.network_upload / 1024).toFixed(2),  // convert to MB/s for better scaling
            (data.network_download / 1024).toFixed(2)  // convert to MB/s for better scaling
        ];
        chart.update();
    }

    window.onload = function() {
        const ctx = document.getElementById('systemInfoChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'bar',
            data: systemInfoChartData,
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Value (%)'
                        }
                    }
                }
            }
        });

        fetchSystemInfo();
        setInterval(fetchSystemInfo, 1000);
    };
</script>
</body>
</html>
