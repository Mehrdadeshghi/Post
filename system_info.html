<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <h1>Management Dashboard</h1>
        <div class="theme-switch-wrapper">
            <span>Light Mode</span>
            <label class="theme-switch" for="checkbox">
                <input type="checkbox" id="checkbox">
                <div class="slider round"></div>
            </label>
            <span>Dark Mode</span>
        </div>
        <div class="card-deck">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">CPU Usage</h5>
                    <p id="cpu_usage" class="card-text">Loading...</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Memory Usage</h5>
                    <p id="memory_usage" class="card-text">Loading...</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Disk Usage</h5>
                    <p id="disk_usage" class="card-text">Loading...</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">CPU Temperature</h5>
                    <p id="cpu_temperature" class="card-text">Loading...</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">System Uptime</h5>
                    <p id="system_uptime" class="card-text">Loading...</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Network Upload</h5>
                    <p id="network_upload" class="card-text">Loading...</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Network Download</h5>
                    <p id="network_download" class="card-text">Loading...</p>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Active Processes</h5>
                    <p id="active_processes" class="card-text">Loading...</p>
                </div>
            </div>
        </div>
        <div class="chart-container mt-4">
            <canvas id="systemInfoChart"></canvas>
        </div>
        <div class="download-buttons mt-4">
            <button onclick="window.location.href='/download/system_info/csv'" class="btn btn-primary">Download CSV</button>
            <button onclick="window.location.href='/download/system_info/excel'" class="btn btn-primary">Download Excel</button>
        </div>
    </div>
    <script>
        async function fetchSystemInfo() {
            try {
                const response = await fetch('/system_info');
                const data = await response.json();
                updateSystemInfo(data);
            } catch (error) {
                console.error('Error fetching system info:', error);
            }
        }

        function updateSystemInfo(data) {
            document.getElementById('cpu_usage').innerText = data.cpu_usage + '%';
            document.getElementById('memory_usage').innerText = data.memory_usage + '%';
            document.getElementById('disk_usage').innerText = data.disk_usage + '%';
            document.getElementById('cpu_temperature').innerText = data.cpu_temperature + 'Â°C';
            document.getElementById('system_uptime').innerText = data.system_uptime;
            document.getElementById('network_upload').innerText = data.network_upload + ' KB/s';
            document.getElementById('network_download').innerText = data.network_download + ' KB/s';
            document.getElementById('active_processes').innerText = data.active_processes;

            updateSystemInfoChart(data);
        }

        function updateSystemInfoChart(data) {
            var currentTime = new Date().toLocaleTimeString();
            systemInfoChartData.labels.push(currentTime);
            systemInfoChartData.datasets[0].data.push(data.cpu_usage);
            systemInfoChartData.datasets[1].data.push(data.memory_usage);
            systemInfoChartData.datasets[2].data.push(data.disk_usage);
            systemInfoChartData.datasets[3].data.push(data.network_upload);
            systemInfoChartData.datasets[4].data.push(data.network_download);

            if (systemInfoChartData.labels.length > 10) {
                systemInfoChartData.labels.shift();
                systemInfoChartData.datasets.forEach(dataset => dataset.data.shift());
            }

            if (!chart) {
                const ctx = document.getElementById('systemInfoChart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'bar',
                    data: systemInfoChartData,
                    options: {
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Zeit'
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Wert'
                                }
                            }
                        }
                    }
                });
            } else {
                chart.update();
            }
        }

        const systemInfoChartData = {
            labels: [],
            datasets: [
                {
                    label: 'CPU Usage (%)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    data: []
                },
                {
                    label: 'Memory Usage (%)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    data: []
                },
                {
                    label: 'Disk Usage (%)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    data: []
                },
                {
                    label: 'Network Upload (KB/s)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    data: []
                },
                {
                    label: 'Network Download (KB/s)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    backgroundColor: 'rgba(255, 159, 64, 0.2)',
                    data: []
                }
            ]
        };

        setInterval(fetchSystemInfo, 1000);
        window.onload = fetchSystemInfo;
    </script>
</body>
</html>
